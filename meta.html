<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remover Metadados de Vídeos</title>
</head>
<body>
    <h1>Remover Metadados de Vídeos</h1>

    <!-- Campo de Upload -->
    <input type="file" id="fileUpload" accept="video/mp4, video/mov">
    <button id="removeMetadataButton">Remover Metadados</button>

    <!-- Barra de Progresso -->
    <div id="progressBar" style="display: none;">
        <div id="progressBarFill"></div>
    </div>

    <!-- Mensagem de Status -->
    <p id="message" style="display: none;">Metadados removidos com sucesso!</p>

    <!-- Link de Download -->
    <a id="saveVideo" download style="display: none;">Clique aqui para baixar seu vídeo limpo!</a>

    <!-- Scripts -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.4/dist/ffmpeg.min.js"></script>
    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        document.getElementById('removeMetadataButton').addEventListener('click', async () => {
            const fileInput = document.getElementById('fileUpload');
            const file = fileInput.files[0];

            if (!file) {
                alert('Por favor, selecione um vídeo.');
                return;
            }

            // Exibe a barra de progresso
            document.getElementById('progressBar').style.display = 'block';

            // Carrega o FFmpeg
            if (!ffmpeg.isLoaded()) {
                await ffmpeg.load();
            }

            // Escreve o arquivo no sistema de arquivos do FFmpeg
            ffmpeg.FS('writeFile', file.name, await fetchFile(file));

            // Remove os metadados
            await ffmpeg.run('-i', file.name, '-map_metadata', '-1', '-c:v', 'copy', '-c:a', 'copy', 'output.mp4');

            // Lê o arquivo processado
            const data = ffmpeg.FS('readFile', 'output.mp4');

            // Cria um link para download
            const videoUrl = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
            const saveVideoLink = document.getElementById('saveVideo');
            saveVideoLink.href = videoUrl;
            saveVideoLink.download = `video-limpo_${Date.now()}.mp4`;
            saveVideoLink.style.display = 'block';

            // Exibe a mensagem de sucesso
            document.getElementById('message').style.display = 'block';

            // Esconde a barra de progresso
            document.getElementById('progressBar').style.display = 'none';
        });
    </script>
</body>
</html>